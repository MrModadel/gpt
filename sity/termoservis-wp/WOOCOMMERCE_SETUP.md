# WooCommerce Setup для динамического фильтра каталога

## Что было сделано

Система фильтрации полностью переписана на **AJAX с динамической загрузкой фильтров из WooCommerce**.

**Теперь работает так:**
1. ✅ При загрузке страницы система **автоматически загружает все атрибуты товаров** из WooCommerce
2. ✅ Фильтры **строятся динамически** на основе доступных значений
3. ✅ **Новые атрибуты** автоматически появляются в фильтрах
4. ✅ **Новые значения атрибутов** сразу видны в фильтре
5. ✅ **Новые товары** сразу участвуют в фильтрации
6. ✅ **Без перезагрузки страницы** — чистый AJAX

## Что нужно сделать в админ-панели WooCommerce

### 1. Создать атрибуты товаров

Перейти: **WooCommerce → Товары → Атрибуты**

Создайте следующие атрибуты (если их ещё нет):

#### Атрибут 1: Тип оборудования
- **Название**: `Тип оборудования`
- **Slug**: `tip-oborudovaniya` (автоматически)
- **Значения** (добавьте по одному):
  - Чиллеры
  - Холодильные агрегаты
  - Комплектующие
  - Специальные решения

#### Атрибут 2: Мощность
- **Название**: `Мощность`
- **Slug**: `moshnost` (автоматически)
- **Значения**:
  - До 50 кВт
  - 50-200 кВт
  - От 200 кВт
  - Индивидуальный расчет

#### Атрибут 3: Отрасль применения
- **Название**: `Отрасль применения`
- **Slug**: `otrasl-primeneniya` (автоматически)
- **Значения**:
  - Пищевая промышленность
  - Металлообработка
  - Химическая промышленность
  - Логистика и склады
  - Фармацевтика

#### Дополнительно: Если нужны новые атрибуты
Например, "Объем" или "Температура охлаждения" — просто создайте их, и они **автоматически появятся в фильтрах на странице каталога**!

### 2. Добавить товары с атрибутами

Перейти: **WooCommerce → Товары → Добавить новый**

**Для каждого товара:**

1. Задайте:
   - Название товара
   - Описание (коротко)
   - Цена (обычная цена)
   - Изображение товара (превью)

2. Спуститесь вниз и найдите **"Атрибуты"**

3. Для каждого атрибута:
   - Нажмите кнопку добавления атрибута
   - Выберите атрибут из списка (например, "Тип оборудования")
   - Выберите значение из предложенного списка (например, "Чиллеры")
   - Отметьте галочку **"Используется для вариантов товаров"** если нужно

4. Нажмите **"Сохранить товар"**

**Пример:**
```
Товар: ЧН-50 Промышленный чиллер
- Тип оборудования: Чиллеры
- Мощность: 50-200 кВт
- Отрасль применения: Пищевая промышленность
- Цена: 150 000 ₽
```

### 3. Проверить фильтры на странице

1. Откройте страницу каталога на сайте
2. Должны появиться 3-5 блоков фильтров (в зависимости от количества созданных атрибутов)
3. Каждый блок покажет количество товаров для каждого значения
4. Нажмите на значение — товары отфильтруются через AJAX

## Как работает система

```
Пользователь выбирает фильтры → JavaScript отправляет AJAX запрос →
PHP обработчик формирует WP_Query с tax_query →
Возвращает отфильтрованные товары → Отображаются на странице
```

### AJAX эндпоинты:

- **`get_available_filters`** — загружает все доступные атрибуты и их значения
- **`filter_products`** — фильтрует товары по выбранным атрибутам
- **`count_filtered_products`** — считает количество найденных товаров

## Файлы которые были изменены/созданы

1. **`ajax-filters.php`** (новый)
   - AJAX обработчики для фильтрации
   - Работает с WooCommerce атрибутами

2. **`page-catalog.php`** (обновлена)
   - Удалены статичные фильтры
   - Добавлена динамическая загрузка через JavaScript
   - Полный AJAX для фильтрации и загрузки товаров

3. **`functions.php`** (обновлена)
   - Добавлен nonce токен для безопасности AJAX
   - Подключен файл ajax-filters.php

## Тестирование

1. **Добавьте несколько товаров** с разными атрибутами
2. **Откройте каталог** — должны появиться фильтры
3. **Выберите фильтры** — товары должны фильтроваться без перезагрузки
4. **Добавьте новый товар** — откройте каталог в новой вкладке, должен появиться

## Возможные проблемы и решения

**Q: Фильтры не загружаются**
A: Проверьте что:
- WooCommerce установлен и активирован
- Созданы атрибуты в админ-панели WooCommerce
- Добавлены товары с этими атрибутами

**Q: Товары не появляются после выбора фильтра**
A: 
- Убедитесь что товар опубликован (статус "Published")
- У товара установлены атрибуты
- Очистите браузер кэш

**Q: На странице ничего не происходит**
A:
- Откройте DevTools (F12) → Console
- Проверьте нет ли ошибок JavaScript
- Проверьте что `termoservisData.ajaxUrl` и `termoservisData.catalogNonce` определены

## Дополнительные возможности

Можно добавить больше атрибутов:
- "Тип охлаждения" (воздушное, водяное, льдистое)
- "Компрессор" (поршневой, винтовой, спиральный)
- "Холодильное вещество" (R410A, R290, R134A)
- "Гарантия" (1 год, 2 года, 3 года)

Все они **автоматически появятся в фильтрах** на странице!
